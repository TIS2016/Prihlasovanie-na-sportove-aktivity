{% load static %}

<!DOCTYPE html>
<html lang="sk">
<head>

    <!-- Bootstrap core CSS -->
    <link href=" {% static 'web/css/bootstrap.css' %} " rel="stylesheet">
    <link href=" {% static 'web/css/jquery-ui.css' %} " rel="stylesheet">


    <title>{% block title %} {% endblock %}</title>

    {% block head-tag %}

    {% endblock %}

</head>

<body>


<div class="page-container">
    <div class="container-fluid">
        {% block logo-buttons %}

        {% endblock %}

        {% block navigation %}

        {% endblock %}

        {% block termin-info %}

        {% endblock %}


        <script>
            // function which open particular day-lesson in new window
            function show_termin_info(id) {
                var dimensions = 'width=500,height=300,left=0,top=100,screenX=0,screenY=100';
                $.ajax({
                    url: 'termin/' + id,
                    type: 'GET', // This is the default though, you don't actually need to always mention it
                    success: function (data) {
                        window.open(this.url, 'termin_info', dimensions);
                    },
                    failure: function (data) {
                        alert('Got an error dude');
                    }
                });
            }
        </script>


        {% block week-grid %}

        {% endblock %}

    </div>
</div>

</body>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>

<script src="{% static 'web/js/jquery-ui.js' %}"></script>

<script src="{% static 'web/js/date.js' %}"></script>

<script src=" {% static 'web/js/bootstrap.min.js' %} "></script>
<!--IE10 viewport hack for Surface/desktop Windows 8 bug -->
{#
<script src=" {% static 'web/js/ie10-viewport-bug-workaround.js' %} "></script>
#}

{% block js %}

{% endblock %}

<script type="text/javascript">
    $(document).ready(function () {
        function mod(n, m) {
            return ((n % m) + m) % m;
        }

        // jquery datepicker added to input text with id "datepicker"
        $(function () {
            $("#datepicker").datepicker({
                onSelect: function () {
                    $(this).change();
                }
            }).on("change", function () {
                var array = document.getElementById('datepicker').value.split('/')
                var d = new Date(array[2], array[1], array[0]);
                var day = mod((d.getDay() - 2), 7);
                for (var i = 1; i <= 110; i++) {
                    if (document.getElementById(i.toString()).style.backgroundColor == "red") {
                        document.getElementById(i.toString()).style.background = "white";
                    }
                }
                select_red_by_day(day);


                var d1 = Date.parse(array[1] + "." + array[0] + "." + array[2]);
                var d2 = Date.parse(array[1] + "." + array[0] + "." + array[2]);
                var d3 = Date.parse(array[1] + "." + array[0] + "." + array[2]);
                var d4 = Date.parse(array[1] + "." + array[0] + "." + array[2]);
                var d5 = Date.parse(array[1] + "." + array[0] + "." + array[2]);


                console.log(d1.getDay());
                if (d1.getDay() != 1) {
                    var md1 = d1.previous().monday();
                    var md2 = d2.previous().monday();
                    var md3 = d3.previous().monday();
                    var md4 = d4.previous().monday();
                    var md5 = d5.previous().monday();
                }
                else {
                    var md1 = d1;
                    var md2 = d2;
                    var md3 = d3;
                    var md4 = d4;
                    var md5 = d5;
                }

                var dd2 = md2.add(1).days();
                var dd3 = md3.add(2).days();
                var dd4 = md4.add(3).days();
                var dd5 = md5.add(4).days();
                console.log(md1 + "|" + dd2 + "|" + dd3 + "|" + dd4 + "|" + dd5);


                var url = window.location.href;


                var data = new FormData();
                data.append('d1', md1);
                data.append('d2', dd2);
                data.append('d3', dd3);
                data.append('d4', dd4);
                data.append('d5', dd5);

            console.log(data);
            function get_db_data() {
                $.ajax({
                    type: 'POST',
                    url: url,
                    data: data,
                    processData: false,
                    contentType: false,
                    success: function (json) {
                        alert(json);
                        data = JSON.parse(json);

                        console.log(data["reservations"]);
                        alert(data["reservations"]);


                    }
                });
            }

            get_db_data();


//                var monday = getMonday();
//                console.log(monday.getDay(), monday.getMonth(), monday.year);
        });
    });
    // this will set to input text current date
    var date_today = function () {
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();
        if (dd < 10) {
            dd = '0' + dd
        }
        if (mm < 10) {
            mm = '0' + mm
        }
        today = dd + '/' + mm + '/' + yyyy;
        return today;
    }
    document.getElementById('datepicker').value = date_today();

    // this function executes when "Zrus" button clicked and change number of people in lesson
    $("#delete").click(function () {
        document.getElementById('1').children[1].innerHTML = "9/9";

    });

    // this will grab checked checkboxes and will return id's of their div element
    function grab_checked() {
        var result = [];
        var divs = $('div[class="checkbox"]');
        var checked = 0;
        for (i = 0; i < divs.length; i++) {
            if (divs[i].children[0].checked) {
                checked += 1;
                result.push(divs[i].id);
            }
        }
        var resultString = checked + " out of " + divs.length + " checkboxes are checked";
        if (checked > 0) {
            $('#div').html(resultString);
            return result;
        } else {
            $('#div').html("No checkbox checked");
            return null;
        }
    }

    // this function executes when "Uloz" button clicked and opened new window with pre-submit info
    $("#save").click(function () {
        var terminy = grab_checked();
        var postUrl = "terminy/"
        if (terminy != null) {
            $.post(postUrl, {termins_id: terminy}, function (response) {
                window.open(postUrl, 'terminy', 'width=500,height=300,left=0,top=100,screenX=0,screenY=100').document.write(response);
            });
        }
    });
    // next ( ">" ) button clicked increase value in input text
    $('#next').click(function () {
        var date = $('#datepicker').datepicker('getDate');
        date.setDate(date.getDate() + 1)
        $('#datepicker').datepicker("setDate", date);
        change_bg_color();
    });
    // previous ( "<" ) button clicked decrease value in input text
    $('#prev').click(function () {
        var date = $('#datepicker').datepicker('getDate');
        date.setDate(date.getDate() - 1)
        $('#datepicker').datepicker("setDate", date);
        change_bg_color();
    });

    function select_red_by_day(day) {

        if (day < 6 && day > 0) {
            var ix = 0;
            for (var i = 1; i <= 110; i++) {
                if (Math.floor(i / day)) {
                    document.getElementById(i.toString()).style.background = "red";
                    day += 5;
                }
                else {
                    if (document.getElementById(i.toString()).style.backgroundColor == "red") {
                        if (ix % 2 == 0) {
                            document.getElementById(i.toString()).style.background = "#F9F9F9";
                        }
                        else {
                            document.getElementById(i.toString()).style.background = "white";
                        }
                        ix += 1;
                    }
                }
            }
        }
        else {
            for (var i = 1; i <= 110; i++) {
                if (document.getElementById(i.toString()).style.backgroundColor == "red") {
                    document.getElementById(i.toString()).style.background = "white";
                }
            }
        }
    }
    ;

    //        function getMonday() {
    //            var array = document.getElementById('datepicker').value.split('/')
    //            var d = new Date(array[2], array[1], array[0]);
    //            var day = mod((d.getDay() - 2), 7),
    //                    diff = d.getDate() - day + (day == 0 ? -6 : 1); // adjust when day is sunday
    //            return new Date(d.setDate(diff));
    //        }

    function change_bg_color() {
        var new_date = $('#datepicker').datepicker('getDate');
        var day = new_date.getDay();
        select_red_by_day(day);
    }
    ;

    var rank = "admin";

    function logic_division() {
        for (var i = 1; i <= 110; i++) {
            if (rank == "student") {
                if (i < 71) {
                    document.getElementById(i.toString()).style.background = "black";
                }
            }
            else if (rank == "ucitel") {
                if (i >= 71) {
                    document.getElementById(i.toString()).style.background = "black";
                }
            }
        }
    }
    ;

    //        function get_numbers() {
    //
    //        }

    function do_stuff() {
//            get_numbers();
        change_bg_color();
        logic_division();
    }
    ;
    window.onload = do_stuff;


    })
    ;
</script>

</html>